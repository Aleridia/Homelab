# Put this file in /etc/nginx/conf.d/security-http.conf (http context).

# Do not leak nginx version.
server_tokens off;

# Tighten connection behavior for abusive clients.
client_body_timeout 10s;
client_header_timeout 10s;
keepalive_timeout 15s;
send_timeout 10s;
client_max_body_size 10m;

# Basic anti-DoS / anti-enumeration controls.
limit_req_zone $binary_remote_addr zone=req_per_ip:20m rate=20r/s;
limit_conn_zone $binary_remote_addr zone=conn_per_ip:20m;

# Flag common scanners and scripted attack clients.
map $http_user_agent $bad_user_agent {
    default 0;
    "~*(?:sqlmap|nikto|nmap|masscan|nessus|acunetix|wpscan|dirbuster|gobuster|zgrab|libwww-perl|python-requests|httpclient)" 1;
}

# Flag common LFI/RFI/probing payloads.
map $request_uri $suspicious_uri {
    default 0;
    "~*(?:\\./\\.|%2e%2e|/etc/passwd|/proc/self/environ|/\\.env|/wp-admin|/wp-login\\.php|/xmlrpc\\.php|/vendor/phpunit|/phpmyadmin|php://|data://|expect://|file://|https?://)" 1;
}
